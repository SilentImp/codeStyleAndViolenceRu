<!DOCTYPE html><html lang="ru"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><title>Кодстайл и насилие</title><link href="css/styles.css" rel="stylesheet"><script data-main="js/presentation" src="js/requirejs/require.js"></script></head><body><form class="go-to-page" action="/select/slide" method="post"><fieldset><input type="text" maxlength="3" value="" placeholder="1"></fieldset></form><section class="progress"><div class="value"></div></section><section class="dark" id="slides"><article class="cover"><div class="container"><h1 class="left">Кодстайл</h1><h1 class="right">Насилие</h1><h1 class="right">Хипстеры</h1></div></article><article class="illustration illustration-h1 cloud center why"><h1><p class="wrapper"> <b>Кодстайл?</b></p></h1></article><article class="illustration illustration-h1 cloud center why"><h1><p class="wrapper"> <b>Зачем мне</b><br><b>это надо?</b></p></h1></article><article class="illustration illustration-b1"><div class="subtitle"> <p>— Не то что бы именно надо. <br> Пока ты работаешь один.</p></div></article><article class="illustration illustration-h2"><div class="subtitle"> <p>— Но как только команда начинает рости …</p></div></article><article class="illustration illustration-b2"></article><article class="illustration illustration-h25"><div class="subtitle"> <p>… всё больше …</p></div></article><article class="illustration illustration-b25"></article><article class="illustration illustration-h3"><div class="subtitle"> <p>… и больше …</p></div></article><article class="illustration illustration-b3"></article><article class="illustration illustration-h4"><div class="subtitle"> <p>… и страннее …</p></div></article><article class="illustration illustration-b4"><div class="subtitle"> <p>… и …</p></div></article><article class="illustration illustration-b5"><div class="subtitle"> <p>… и в определенный момент станновится очевидно, <br> что нужны правила.</p></div></article><article class="center list-1"><div class="wrapper"><h1>Что за правила нужны?</h1><ul><li>Скрипты <b>(ECMA X, TypeScript, Kotlin, etc. )</b></li><li>Стили <b>(CSS, PostCSS, Sass, Less, Stylus, etc.)</b></li><li>Рабочий процесс <b>(git flow, github flow, gitlab flow, etc.)</b></li></ul></div></article><article class="center list-2"><div class="wrapper"><h1>Рабочий процесс включает</h1><ul><li>Процесс</li><li>Именование веток</li><li>Именование коммитов</li></ul></div></article><article class="choose cloud center"><h1> <p class="wrapper">А как <br>выбрать <br>кодстайл?</p></h1></article><article class="lazy cloud center"><h1> <p class="wrapper">Его<br>должен поддерживать кто то, кто<br>не я</p></h1><div class="subtitle"><p>— Потому что мы тут с вами не лучший мир строим, мы пишем   программы, что бы заработать деньги, <br> купить ружье … и … о чем это я?</p></div></article><article class="lazy lazy--trendy cloud center"><h1> <p class="wrapper">Он <br>должен быть модным</p></h1><div class="subtitle"><p>— Потому что это увеличивает ценность членов вашей команды как   разработчиков и потому его будет проще внедрить</p></div></article><article class="choose choose-2 cloud center"><h1> <p class="wrapper">Что то<br>ещё?</p></h1></article><article class="lazy lazy--nope cloud center"><h1> <p class="wrapper">НЕТ</p></h1><div class="subtitle"><p>— Всем начхать используете вы пробелы или табы: IDE отлично   справится и с теми, и с другими. Важно единообразие.</p></div></article><article class="illustration illustration-airbnb"></article><article class="center qrcode var-2"><div class="wrapper"><div class="half"><h2>Airbnb JavaScript Style Guide</h2></div><div class="half"><img src="images/airbnb_js.svg" alt="QRCODE with link to Airbnb js style guide"></div><p><a href="https://github.com/airbnb/javascript" data-click>https://github.com/airbnb/javascript</a></p></div></article><article class="center qrcode var-2"><div class="wrapper"><div class="half"><h2>Airbnb CSS Style Guide</h2></div><div class="half"><img src="images/airbnb_js.svg" alt="QRCODE with link to Airbnb js style guide"></div><p><a href="https://github.com/airbnb/css" data-click>https://github.com/airbnb/css</a></p></div></article><article class="illustration illustration-standard"></article><article class="center qrcode var-2"><div class="wrapper"><div class="half"><h2>Standard JavaScript Style Guide</h2></div><div class="half"><img src="images/standard_js.svg" alt="QRCODE with link to Airbnb js style guide"></div><p><a href="https://github.com/standard/standard" data-click>https://github.com/standard/standard</a></p></div></article><article class="illustration illustration-git-flow"></article><article class="center qrcode var-2"><div class="wrapper"><div class="half"><h2>A successful Git branching model</h2></div><div class="half"><img src="images/git-flow-link.svg" alt="QRCODE with link to original gitflow article"></div><p><a href="http://nvie.com/posts/a-successful-git-branching-model/" data-click>https://goo.gl/GDaF  </a></p></div></article><article class="illustration illustration-github"></article><article class="center qrcode var-6"><div class="wrapper"><div class="half"><h2>GitHub<br>branching model</h2></div><div class="half"><img src="images/github-flow-link.svg" alt="QRCODE with link to original gitflow article"></div><p><a href="https://githubflow.github.io/" data-click>https://githubflow.github.io/</a></p></div></article><article class="illustration illustration-gitlab"></article><article class="center qrcode var-6"><div class="wrapper"><div class="half"><h2>GitLab<br>branching model</h2></div><div class="half"><img src="images/gitlab-flow-link.svg" alt="QRCODE with link to original gitflow article"></div><p><a href="https://about.gitlab.com/2014/09/29/gitlab-flow/" data-click>https://goo.gl/Z0w1nQ</a></p></div></article><article class="choose choose-3 cloud center"><h1> <p class="wrapper">И всё?<b>погнали?</b></p></h1></article><article class="illustration illustration--indian"><div class="subtitle"> <p>— Да! Это ваши коллеги из отделения в Дели бегут, что бы внедрить   ваш кодстайл. Вот прямо таки вприпрыжку и волосы назад!</p></div></article><article class="illustration illustration--indian"><div class="subtitle"><p>— На самом деле нет. Никому ваш кодстайл не нужен.</p></div></article><article class="artist cloud center"><h1> <p class="wrapper">Я — художник!<br>Не смейте меня ограничивать!</p></h1><div class="subtitle"> <p>— Если хотите внедрить кодстайл, то его нужно явно   определить, автоматически проверять и принуждать использовать. </p></div></article><article class="illustration illustration--editorconfig"></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">$ vi .editorconfig
</code></pre></div></article><article class="center code-2"><div class="wrapper"><pre><code>[*]
indent_style = space
indent_size = 2
tab_width = 2
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true
</code></pre></div></article><article class="illustration illustration--atom"></article><article class="screen screen--atom-editorconfig"></article><article class="screen screen--atom-editorconfig-error"></article><article class="screen screen--atom-editorconfig-fix"></article><article class="illustration illustration--ws"></article><article class="screen screen--ws-editorconfig"></article><article class="center qrcode var-6"><div class="wrapper"><div class="half"><h2>EditorConfig</h2></div><div class="half"><img src="images/editorconfig_link.svg" alt="QRCODE with link to eslint"></div><p><a href="http://editorconfig.org/" data-click>http://editorconfig.org/</a></p></div></article><article class="illustration illustration--eslint"></article><article class="center qrcode var-6"><div class="wrapper"><div class="half"><h2>ESLint</h2></div><div class="half"><img src="images/gitlab-flow-link.svg" alt="QRCODE with link to eslint"></div><p><a href="https://eslint.org/" data-click>https://eslint.org/</a></p></div></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">$ sudo npm i -g eslint
$ npm i -D eslint
</code></pre></div></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">$ eslint --init
</code></pre></div></article><article class="screen screen--eslint-init"></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">$ vi .eslintrc
</code></pre></div></article><article class="center code-1"><div class="wrapper"><pre><code class="javascript">// .eslintrc
{
  "extends": "airbnb",
  "plugins": [
    "react",
    "jsx-a11y",
    "import"
  ]
}
</code></pre></div></article><article class="center code-0"><div class="wrapper"><pre><code class="bash">$ npm info 
    "eslint-config-airbnb@latest" 
    peerDependencies

{ eslint: '^3.19.0 || ^4.3.0',
  'eslint-plugin-jsx-a11y': '^5.1.1',
  'eslint-plugin-import': '^2.7.0',
  'eslint-plugin-react': '^7.1.0' }
</code></pre></div></article><article class="center code-0"><div class="wrapper"><pre><code class="bash">$ npm i -D eslint-plugin-react@latest
$ npm i -D eslint-plugin-import@latest
$ npm i -D eslint-plugin-jsx-a11y@latest
$ npm i -D eslint-config-airbnb@latest
</code></pre></div></article><article class="center code-2"><div class="wrapper"><pre><code class="javascript">// .eslintrc
{
  "parser": "babel-eslint",
  "extends": "airbnb",
  "plugins": [
    "react",
    "jsx-a11y",
    "import"
  ]
}
</code></pre></div></article><article class="center code-3"><div class="wrapper"><pre><code class="javascript">// .eslintrc
{
  "parser": "babel-eslint",
  "extends": "airbnb",
  "plugins": [
    "react",
    "jsx-a11y",
    "import"
  ],
  "env": {
    "browser": true,
    "es6": true,
  },
}
</code></pre></div></article><article class="center code-7"><div class="wrapper"><pre><code class="bash">$ npm i -D babel-eslint@latest
</code></pre></div></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">$ eslint ./source
    --color 
    --format stylish
</code></pre></div></article><article class="screen screen--eslint-errors"></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">$ eslint ./source
    --color 
    --format stylish
    --fix
</code></pre></div></article><article class="screen screen--eslint-better"></article><article class="center code-1"><div class="wrapper"><pre><code class="js">// package.json
{ // …
  "scripts": {
    "lint:js": "eslint ./source 
                  --color 
                  --format stylish 
                  --fix"
  }
}
</code></pre></div></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">$ npm run lint:js
</code></pre></div></article><article class="change cloud center"><h1> <p class="wrapper">И что,<br>мне это ручками каждый раз запускать?</p></h1><div class="subtitle"> <p>— Что бы видеть проблемы в процессе работы <br> нужно настроить редактор</p></div></article><article class="illustration illustration--atom"></article><article class="screen screen--eslint-atom"></article><article class="screen screen--eslint-atom-fix"></article><article class="screen screen--eslint-atom-error"></article><article class="illustration illustration--ws"></article><article class="screen screen--ws-preferences"></article><article class="screen screen--ws-eslint"></article><article class="screen screen--ws-eslint-fix"></article><article class="screen screen--ws-eslint-error"></article><article class="think cloud center"><h1> <p class="wrapper">Зашибись,<br>но что если<br>я это всё просто проигнорирую?</p></h1><div class="subtitle"> <p>— Тогда, очевидно, мне придется использовать…</p></div></article><article class="illustration illustration--hook cloud center hook"><h1> <p class="wrapper">Хук</p></h1></article><article class="center code-7"><div class="wrapper"><pre><code class="bash">#!/bin/bash
# .git/hooks/pre-commit
if !(npm run lint:js --silent) then
  exit 1;
fi
</code></pre></div></article><article class="center qrcode var-6"><div class="wrapper"><div class="half"><h2>Source Control<br>Integrations</h2></div><div class="half"><img src="images/hook.svg" alt="QRCODE with link"></div><p><a href="https://eslint.org/docs/user-guide/integrations#source-control" data-click>http://bit.ly/2w5y30Q</a></p></div></article><article class="think cloud center"><h1> <p class="wrapper">Ты правда думаешь, что я себе pre-commit установлю?</p></h1></article><article class="think cloud center"><h1> <p class="wrapper">Я себе что враг? И вообще — сложно же.</p></h1></article><article class="think think--repo cloud center"><h1> <p class="wrapper">В репу хуки не добавить.</p></h1></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">$ npm i -D lint-staged
$ npm i -D husky
</code></pre></div></article><article class="center code-1"><div class="wrapper"><pre><code class="js">// package.json
{ // …
  "scripts": { // …
    "precommit": "lint-staged"
  },
  "lint-staged": { // …
    "*.{js,jsx}": "eslint"
  }
}
</code></pre></div></article><article class="screen screen--husky"></article><article class="think think--left cloud center"><h1> <p class="wrapper">Много ли останется так от моего уникального кода?</p></h1></article><article class="screen screen--prettier"></article><article class="center qrcode var-6"><div class="wrapper"><div class="half"><h2>Prettier</h2></div><div class="half"><img src="images/prettier-link.svg" alt="QRCODE with link to eslint"></div><p><a href="https://prettier.io/" data-click>https://prettier.io/</a></p></div></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">$ npm i -D -E prettier
</code></pre></div></article><article class="center code-3"><div class="wrapper"><pre><code class="javascript">// .prettierrc
{
  "parser": "babylon",
  "useTabs": false,
  "tabWidth": 2,
  "singleQuote": true,
  "semi": true,
  "printWidth": 100,
  "trailingComma": "all",
  "bracketSpacing": true,
  "jsxBracketSameLine": true,
  "proseWrap": false,
}

</code></pre></div></article><article class="center code-1"><div class="wrapper"><pre><code class="js">// package.json
{ 
  "scripts": { 
    "format": "prettier 
                  --config .prettierrc
                  --write 'src/**/*.{js,jsx}'"
  }, 
}
</code></pre></div></article><article class="center code-0"><div class="wrapper"><pre><code class="bash">$ npm i -D eslint-plugin-prettier
</code></pre></div></article><article class="center code-1"><div class="wrapper"><pre><code class="javascript">// .eslintrc
{
  "plugins": [
    "prettier",
  ],
  "rules": {
    "prettier/prettier": "error"
  },
}
</code></pre></div></article><article class="center code-6"><div class="wrapper"><pre><code class="bash">$ npm i -D eslint-config-prettier
</code></pre></div></article><article class="center code-1"><div class="wrapper"><pre><code class="javascript">// .eslintrc
{
  "extends": [
    "airbnb", 
    "prettier", 
    "prettier/react"
  ],
}
</code></pre></div></article><article class="think think--swear cloud center"><h1> <p class="wrapper">&#x2589;&#x2589;&#x2589;&#x2589;</p></h1></article><article class="talk cloud center"><h1> <p class="wrapper">А что там со стилями?</p></h1></article><article class="screen screen--stylelint"></article><article class="center qrcode var-6"><div class="wrapper"><div class="half"><h2>Stylelint</h2></div><div class="half"><img src="images/stylelint_link.svg" alt="QRCODE with link"></div><p><a href="https://stylelint.io/" data-click>https://stylelint.io/</a></p></div></article><article class="center code-0"><div class="wrapper"><pre><code class="bash">$ sudo npm i -g stylelint
$ npm i -D stylelint
$ npm i -D stylelint-config-standard
$ vi .stylelintrc
</code></pre></div></article><article class="center code-0"><div class="wrapper"><pre><code class="js">{
  "syntax": "less",
  "extends": "stylelint-config-standard",
  "rules": {
    // …
  }
}
</code></pre></div></article><article class="center qrcode var-6"><div class="wrapper"><div class="half"><h2>Airbnb Stylelint Config PR</h2></div><div class="half"><img src="images/stylelint-airbnb-issue.svg" alt="QRCODE with link"></div><p><a href="https://github.com/airbnb/css/pull/56/files#diff-c8daf3b8e5463995761e914cf32b47a5" data-click>http://bit.ly/2zTHQHN</a></p></div></article><article class="center qrcode var-6"><div class="wrapper"><div class="half"><h2>Airbnb Stylelint Config #1</h2></div><div class="half"><img src="images/stylelint-airbnb-1.svg" alt="QRCODE with link"></div><p><a href="https://gist.github.com/DanielaValero/b3a72b2f3d0c85c1985d5d2d7497f347" data-click>http://bit.ly/2vwQmsD</a></p></div></article><article class="center qrcode var-6"><div class="wrapper"><div class="half"><h2>Airbnb Stylelint Config #2</h2></div><div class="half"><img src="images/stylelint-airbnb-2.svg" alt="QRCODE with link"></div><p><a href="https://gist.github.com/SilentImp/64d8daa0d890e6ba4aa00d5dc2c273d8" data-click>http://bit.ly/2wGfVMU</a></p></div></article><article class="center code-6"><div class="wrapper"><pre><code class="bash">stylelint ./src/**/*.less 
            --syntax less 
            --color 
            --formatter verbose
</code></pre></div></article><article class="screen screen--stylelint-error"></article><article class="center code-6"><div class="wrapper"><pre><code class="bash">stylelint ./src/**/*.less 
            --syntax less 
            --color 
            --formatter verbose
            --fix
</code></pre></div></article><article class="screen screen--stylelint-fix"></article><article class="center code-2"><div class="wrapper"><pre><code class="js">// package.json
{ // …
  "scripts": {
    "lint:less": "stylelint ./src/**/*.less 
                            --syntax less 
                            --color 
                            --formatter verbose
                            --fix"
  }
}
</code></pre></div></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">$ npm run lint:less
</code></pre></div></article><article class="illustration illustration--atom"></article><article class="screen screen--sytlelint-atom"></article><article class="illustration illustration--ws"></article><article class="screen screen--ws-stylelint"></article><article class="screen screen--ws-errors"></article><article class="talk talk--2 cloud center"><h1> <p class="wrapper">И никаких хуков, да?</p></h1><div class="subtitle"> <p>— Нет.</p></div></article><article class="center code-1"><div class="wrapper"><pre><code class="js">// package.json
{ // …
  "scripts": { // …
    "precommit": "lint-staged"
  },
  "lint-staged": { // …
    "*.less": "stylelint"
  }
}
</code></pre></div></article><article class="screen screen--husky-less"></article><article class="talk talk--3 cloud center"><h1> <p class="wrapper">&#x2589;&#x2589;&#x2589; &#x2589;&#x2589; &#x2589;<br>&#x2589;&#x2589;&#x2589;&#x2589;&#x2589;</p></h1><h2><p class="wrapper">&#x2589;&#x2589;&#x2589;&#x2589;&#x2589;&#x2589;&#x2589;</p></h2></article><article class="flow cloud center"><h1> <p class="wrapper">А что <br>насчет рабочего процесса?</p></h1><div class="subtitle"> <p>— Ещё больше хуков…</p></div></article><article class="flow-demo"><div class="wrapper"></div></article><article class="center code-7"><div class="wrapper"><pre><code class="bash">vi ./hooks/commit-msg
chmod 0755 ./hooks/commit-msg
</code></pre></div></article><article class="center code-2"><div class="wrapper"><pre><code class="bash">#!/bin/bash
MESSAGE=`cat "$1"`;
if (![[ "$MESSAGE" =~ ^[A-Z]+-[0-9]+\ -\ .*$ ]]) 
  && [ "$MESSAGE" != "merge" ]; 
  then 
    echo "Wrong commit message format."; 
    exit 1;
fi
</code></pre></div></article><article class="center code-2"><div class="wrapper"><pre><code class="bash">if [[ "$MESSAGE" =~ ([а-яА-Я]+) ]]; then 
  echo "Don't use russian for commit message."; 
  exit 2;
fi
</code></pre></div></article><article class="center code-2"><div class="wrapper"><pre><code class="bash">if (![[ "$MESSAGE" =~ ^[A-Z]+-[0-9]+\ -\ .{5,}$ ]]) 
  && [ "$MESSAGE" != "merge" ]; then 
    echo "Commit message is too short, 
          try to be more descriptive."; 
    exit 3;
fi
</code></pre></div></article><article class="center code-2"><div class="wrapper"><pre><code class="js">// package.json
{ // …
  "scripts": { // …
    "commitmsg": "./hooks/commit-msg ${GIT_PARAMS}"
  },
  // …
}
</code></pre></div></article><article class="screen screen--husky-message"></article><article class="screen screen--bash"></article><article class="screen screen--windows"></article><article class="screen screen--bc"></article><article class="center code-9"><div class="wrapper"><pre><code class="bash">npm init
</code></pre></div></article><article class="center code-8"><div class="wrapper"><pre><code class="bash">npm i -S command-line-args
</code></pre></div></article><article class="center code-8"><div class="wrapper"><pre><code class="javascript">// index.js
#! /usr/bin/env node
</code></pre></div></article><article class="center code-1"><div class="wrapper"><pre><code class="javascript">// index.js
#! /usr/bin/env node
const fs = require('fs');
const filePath = process.argv[2];
if (!fs.existsSync(filePath)) {
  console.log('Can not read commit message');
  process.exit(1);
}
const message = fs.readFileSync(filePath);
</code></pre></div></article><article class="center code-2"><div class="wrapper"><pre><code class="javascript">const commandLineArgs = require('command-line-args');
const optionDefinitions = [{ 
  name: 'regexp', 
  alias: 'r', 
  type: String, 
  defaultValue: '^[A-Z]+-[0-9]+\s-\s[\W\w\s]{5,}[\s]*$' },
];
const cli = commandLineArgs(optionDefinitions);
</code></pre></div></article><article class="center code-1"><div class="wrapper"><pre><code class="javascript">const commonRegexp = new RegExp(
  cli.regexp, 
  'ig'
);
if (!commonRegexp.test(message)) {
  console.log("Wrong commit message format");
  process.exit(3);
}
process.exit(0);
</code></pre></div></article><article class="center code-1"><div class="wrapper"><pre><code class="json">// package.json
"name": "my-message-hook",
"main": "index.js",
"bin": {"commit-msg": "index.js"},
"scripts": {
  "release": "npm version patch && 
              git push --tags && 
              npm publish --access public"
}
</code></pre></div></article><article class="center code-8"><div class="wrapper"><pre><code class="bash">npm i -S my-message-hook
</code></pre></div></article><article class="center code-6"><div class="wrapper"><pre><code class="json">// package.json
"scripts": {
  "commitmsg": "commit-msg  
                  ${GIT_PARAMS} 
                  -r MyRegExp"
},
</code></pre></div></article><article class="flow flow--2 cloud center"><h1> <p class="wrapper">И всё?</p></h1><div class="subtitle"> <p>— Нет</p></div></article><article class="illustration illustration-gitlab"></article><article class="screen screen--protect-branch-1"></article><article class="screen screen--protect-branch-2"></article><article class="screen screen--protect-push"></article><article class="screen screen--pushed"></article><article class="flow flow--3 cloud center"><h1> <p class="wrapper">&#x2589;&#x2589;&#x2589;&#x2589;&#x2589;<b>,</b><br><b>что дальше?</b></p></h1></article><article class="illustration illustration--punk"></article><article class="voodoo cloud center"><h1> <p class="wrapper">Просто хотел дать тебе знать,<br>что мы сделали куклу вуду,<br><b>&#x2589;&#x2589;&#x2589;&#x2589;&#x2589;&#x2589;</b></p></h1></article><article class="contacts center qrcode"><div class="wrapper"><div class="about-speaker half"><p class="name">Anton Nemtsev</p><p class="link">http://silentimp.info/</p><p class="twitter">@silentimp</p><p class="email">thesilentimp@gmail.com</p><p class="skype">skype: ravencry</p></div><div class="half"><img src="images/git.svg" alt="QRCODE cо ссылкой на доклад"></div><p><a href="https://github.com/SilentImp/codeStyleAndViolence" data-click>https://goo.gl/31KBF6</a></p></div></article></section></body></html>